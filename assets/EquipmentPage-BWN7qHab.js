import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as u,i as X,j as E,w as o,b as n,o as x,e as V,a as t,f as r,t as D,c as Y,E as M}from"./index-3epILxad.js";const Z={class:"toolbar"},ee={class:"station-header"},te={key:1},le={style:{"text-align":"right","margin-top":"10px"}},ae={__name:"EquipmentPage",setup(oe){const y=u(!1),c=u(!1),v=u(""),f=u(null),U=u(null),$=u([]),C=u(null),b=u([]),p=u([{id:1,device_code:"ACD-001",name:"氣密檢測機 A1",location:"產線一區",status:"online",stations:[{id:101,station_no:1,enabled:!0,last_test_at:"2025-10-26 13:59"},{id:102,station_no:2,enabled:!0,last_test_at:"2025-10-26 13:50"},{id:103,station_no:3,enabled:!1,last_test_at:"-"},{id:104,station_no:4,enabled:!1,last_test_at:"-"}],modelMap:Array.from({length:100},(a,e)=>({channel:e+1,model:e===0?"MAFR-302":"",editable:e!==0}))},{id:2,device_code:"BCD-002",name:"氣密檢測機 B1",location:"產線二區",status:"offline",stations:[{id:201,station_no:1,enabled:!0,last_test_at:"2025-10-25 21:00"},{id:202,station_no:2,enabled:!1,last_test_at:"-"},{id:203,station_no:3,enabled:!1,last_test_at:"-"},{id:204,station_no:4,enabled:!1,last_test_at:"-"}],modelMap:Array.from({length:100},(a,e)=>({channel:e+1,model:"",editable:!0}))},{id:3,device_code:"CCD-003",name:"氣密檢測機 C1",location:"產線三區",status:"maintenance",stations:[{id:301,station_no:1,enabled:!0,last_test_at:"-"},{id:302,station_no:2,enabled:!1,last_test_at:"-"},{id:303,station_no:3,enabled:!1,last_test_at:"-"},{id:304,station_no:4,enabled:!1,last_test_at:"-"}],modelMap:Array.from({length:100},(a,e)=>({channel:e+1,model:"",editable:!0}))},{id:4,device_code:"DCD-004",name:"氣密檢測機 D1",location:"產線四區",status:"online",stations:[{id:401,station_no:1,enabled:!0,last_test_at:"2025-10-26 14:55"},{id:402,station_no:2,enabled:!0,last_test_at:"2025-10-26 14:40"},{id:403,station_no:3,enabled:!0,last_test_at:"2025-10-26 14:50"},{id:404,station_no:4,enabled:!1,last_test_at:"-"}],modelMap:Array.from({length:100},(a,e)=>({channel:e+1,model:"",editable:!0}))}]),q=X(()=>{if(!v.value)return p.value;const a=v.value.toLowerCase();return p.value.filter(e=>e.name.toLowerCase().includes(a)||e.device_code.toLowerCase().includes(a))});function z(a){switch(a){case"online":return"success";case"offline":return"danger";case"maintenance":return"warning";default:return"info"}}function B(a,e){console.log(`設備 ${a} 的站點 ${e.station_no} 改為`,e.enabled)}function R(a){const e=a.stations.length+1;a.stations.push({id:Date.now(),station_no:e,enabled:!0,last_test_at:"-"}),M.success(`已新增站點 ${e}`)}function N(a){C.value=a,b.value=a.modelMap,y.value=!0}function F(){b.value.forEach(a=>a.editable=!0),M.info("已開啟重新編輯模式")}function L(){b.value.forEach(a=>a.editable=!1),M.success("型號設定已更新")}const s=u({device_code:"",name:"",location:"",status:"online"}),S={device_code:[{required:!0,message:"必填",trigger:"blur"}],name:[{required:!0,message:"必填",trigger:"blur"}],location:[{required:!0,message:"必填",trigger:"blur"}]};function h(a=null){a?(f.value=a,s.value={...a}):(f.value=null,s.value={device_code:"",name:"",location:"",status:"online"}),c.value=!0}function I(){U.value.validate(a=>{if(a){if(f.value){const e=p.value.findIndex(m=>m.id===f.value.id);e!==-1&&(p.value[e]={...f.value,...s.value})}else{const e={...s.value,id:Date.now(),stations:[],modelMap:Array.from({length:10},(m,d)=>({channel:d+1,model:"",editable:!0}))};p.value.push(e)}c.value=!1}})}function P(a){p.value=p.value.filter(e=>e.id!==a)}return(a,e)=>{const m=n("el-input"),d=n("el-button"),i=n("el-table-column"),T=n("el-switch"),w=n("el-table"),j=n("el-tag"),K=n("el-popconfirm"),G=n("el-drawer"),g=n("el-form-item"),k=n("el-option"),H=n("el-select"),J=n("el-form"),O=n("el-dialog"),Q=n("el-card");return x(),E(Q,{class:"equipment-page"},{default:o(()=>[V("div",Z,[t(m,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),placeholder:"搜尋設備名稱或代碼",style:{"max-width":"260px"}},null,8,["modelValue"]),t(d,{type:"primary",onClick:e[1]||(e[1]=l=>h())},{default:o(()=>[...e[10]||(e[10]=[r("新增設備",-1)])]),_:1})]),t(w,{data:q.value,style:{width:"100%"},border:"","row-key":"id","expand-row-keys":$.value,"onUpdate:expandRowKeys":e[2]||(e[2]=l=>$.value=l)},{default:o(()=>[t(i,{type:"expand"},{default:o(({row:l})=>[V("div",ee,[V("h4",null,D(l.name)+" - 站點清單",1),t(d,{size:"small",type:"success",onClick:_=>R(l)},{default:o(()=>[...e[11]||(e[11]=[r("新增站點",-1)])]),_:1},8,["onClick"])]),t(w,{data:l.stations,size:"small",border:""},{default:o(()=>[t(i,{prop:"station_no",label:"站點",width:"100"}),t(i,{prop:"enabled",label:"啟用",width:"100"},{default:o(({row:_})=>[t(T,{modelValue:_.enabled,"onUpdate:modelValue":A=>_.enabled=A,onChange:A=>B(l.id,_)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),t(i,{prop:"last_test_at",label:"最近測試"})]),_:2},1032,["data"])]),_:1}),t(i,{prop:"device_code",label:"設備代號",width:"140"}),t(i,{prop:"name",label:"名稱"}),t(i,{prop:"location",label:"位置",width:"120"}),t(i,{prop:"status",label:"狀態",width:"120"},{default:o(({row:l})=>[t(j,{type:z(l.status)},{default:o(()=>[r(D(l.status),1)]),_:2},1032,["type"])]),_:1}),t(i,{label:"操作",width:"300"},{default:o(({row:l})=>[t(d,{size:"small",type:"primary",onClick:_=>h(l)},{default:o(()=>[...e[12]||(e[12]=[r("編輯",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"info",onClick:_=>N(l)},{default:o(()=>[...e[13]||(e[13]=[r("型號對照表",-1)])]),_:1},8,["onClick"]),t(K,{title:"確定刪除這台設備？",onConfirm:_=>P(l.id)},{reference:o(()=>[t(d,{size:"small",type:"danger"},{default:o(()=>[...e[14]||(e[14]=[r("刪除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data","expand-row-keys"]),t(G,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),title:C.value?`型號對照表 - ${C.value.name}`:"型號對照表",size:"45%"},{default:o(()=>[t(w,{data:b.value,border:"",height:"70vh"},{default:o(()=>[t(i,{prop:"channel",label:"配方頻道",width:"120"}),t(i,{label:"型號"},{default:o(({row:l})=>[l.editable?(x(),E(m,{key:0,modelValue:l.model,"onUpdate:modelValue":_=>l.model=_,placeholder:"輸入產品型號"},null,8,["modelValue","onUpdate:modelValue"])):(x(),Y("span",te,D(l.model),1))]),_:1})]),_:1},8,["data"]),V("div",le,[t(d,{onClick:F},{default:o(()=>[...e[15]||(e[15]=[r("重新編輯",-1)])]),_:1}),t(d,{type:"primary",onClick:L},{default:o(()=>[...e[16]||(e[16]=[r("儲存設定",-1)])]),_:1})])]),_:1},8,["modelValue","title"]),t(O,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=l=>c.value=l),title:f.value?"編輯設備":"新增設備",width:"500px"},{footer:o(()=>[t(d,{onClick:e[8]||(e[8]=l=>c.value=!1)},{default:o(()=>[...e[17]||(e[17]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:I},{default:o(()=>[...e[18]||(e[18]=[r("儲存",-1)])]),_:1})]),default:o(()=>[t(J,{model:s.value,"label-width":"100px",rules:S,ref_key:"formRef",ref:U},{default:o(()=>[t(g,{label:"設備代號",prop:"device_code"},{default:o(()=>[t(m,{modelValue:s.value.device_code,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.device_code=l)},null,8,["modelValue"])]),_:1}),t(g,{label:"名稱",prop:"name"},{default:o(()=>[t(m,{modelValue:s.value.name,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.name=l)},null,8,["modelValue"])]),_:1}),t(g,{label:"位置",prop:"location"},{default:o(()=>[t(m,{modelValue:s.value.location,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.location=l)},null,8,["modelValue"])]),_:1}),t(g,{label:"狀態",prop:"status"},{default:o(()=>[t(H,{modelValue:s.value.status,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.status=l),placeholder:"選擇狀態"},{default:o(()=>[t(k,{label:"online",value:"online"}),t(k,{label:"offline",value:"offline"}),t(k,{label:"maintenance",value:"maintenance"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}},de=W(ae,[["__scopeId","data-v-3231bda2"]]);export{de as default};
